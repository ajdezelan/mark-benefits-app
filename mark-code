import React, { useState } from 'react';
import { BarChart3, MessageSquare, Heart, TrendingUp, GraduationCap, Menu, X, CheckCircle, AlertCircle, DollarSign, ArrowRight, Users, Shield, Calculator, Download, Mail, Calendar, FileText } from 'lucide-react';

// Export utility functions
const downloadPDF = (results) => {
  const reportContent = `
AIM TRUST COMPARISON REPORT
${results.municipality}
Generated: ${new Date().toLocaleDateString()}

CURRENT SITUATION:
• Current AIM Cost: $${results.aimCost.toLocaleString()}/year
• Cost per employee: $${results.totalPremium}/month

MARKET ALTERNATIVE:
• Estimated Market Cost: $${results.marketCost.toLocaleString()}/year
• Cost per employee: $${results.marketPremium}/month

POTENTIAL SAVINGS:
• Annual Savings: $${results.savings.toLocaleString()}
• Monthly Savings: $${results.monthlySavings.toLocaleString()}
• Percentage Reduction: ${results.savingsPercent}%

RECOMMENDATION:
${results.recommendation}

Generated by Mark - From Hire to Retire
  `;

  const blob = new Blob([reportContent], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${results.municipality.replace(/\s+/g, '-')}-AIM-Analysis.txt`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
};

const emailReport = (results) => {
  const subject = encodeURIComponent(`AIM Trust Analysis - ${results.municipality}`);
  const body = encodeURIComponent(`Hi,

I've completed an analysis of our current AIM Trust costs vs. market alternatives.

KEY FINDINGS:
• Current Annual Cost: $${results.aimCost.toLocaleString()}
• Estimated Market Cost: $${results.marketCost.toLocaleString()}
• Potential Annual Savings: $${results.savings.toLocaleString()} (${results.savingsPercent}% reduction)

${results.recommendation}

Let's schedule a time to discuss this opportunity.

Best regards`);

  // Try Gmail first, fallback to default email client
  const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&su=${subject}&body=${body}`;
  const mailtoUrl = `mailto:?subject=${subject}&body=${body}`;
  
  // Open Gmail in new tab
  const win = window.open(gmailUrl, '_blank');
  
  // Fallback to mailto if popup blocked
  if (!win) {
    window.location.href = mailtoUrl;
  }
};

const scheduleWebinarMeeting = (results) => {
  const title = encodeURIComponent(`Benefits Review: AIM Trust Analysis - ${results.municipality}`);
  const details = encodeURIComponent(`Discuss potential savings of $${results.savings.toLocaleString()}/year by transitioning from AIM Trust to market alternatives.

Key Discussion Points:
• Current costs vs. market rates
• Implementation timeline
• Employee communication strategy
• Plan design options

Analysis shows ${results.savingsPercent}% potential cost reduction.`);
  
  // Google Calendar
  const startDate = new Date();
  startDate.setDate(startDate.getDate() + 7); // Schedule 1 week out
  const endDate = new Date(startDate);
  endDate.setHours(endDate.getHours() + 1);
  
  const formatDate = (date) => {
    return date.toISOString().replace(/-|:|\.\d+/g, '');
  };
  
  const googleCalUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&details=${details}&dates=${formatDate(startDate)}/${formatDate(endDate)}`;
  
  // Outlook Calendar
  const outlookCalUrl = `https://outlook.office.com/calendar/0/deeplink/compose?subject=${title}&body=${details}&startdt=${startDate.toISOString()}&enddt=${endDate.toISOString()}`;
  
  // Prompt user to choose
  const useGoogle = window.confirm('Create event in Google Calendar? (Click Cancel for Outlook)');
  window.open(useGoogle ? googleCalUrl : outlookCalUrl, '_blank');
};

const MarkApp = () => {
  const [activeTab, setActiveTab] = useState('landing');
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

  const tabs = [
    { id: 'landing', name: 'Home', icon: Shield },
    { id: 'chat', name: 'Ask Mark', icon: MessageSquare },
    { id: 'analyzer', name: 'Cost Analyzer', icon: BarChart3 },
    { id: 'aim', name: 'Market Comparison', icon: TrendingUp },
    { id: 'medicare', name: 'Medicare', icon: Heart },
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50">
      <header className="bg-white shadow-sm border-b">
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex justify-between items-center">
            <div className="flex items-center space-x-4">
              <div className="bg-blue-900 rounded-lg p-3 shadow-lg cursor-pointer" onClick={() => setActiveTab('landing')}>
                <div className="text-center">
                  <div className="text-3xl font-black text-blue-400 tracking-wider">MARK</div>
                  <div className="text-xs font-semibold text-yellow-400 tracking-wider">FROM HIRE TO RETIRE</div>
                </div>
              </div>
            </div>
            <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className="lg:hidden">
              {mobileMenuOpen ? <X /> : <Menu />}
            </button>
          </div>
        </div>
      </header>

      <div className="max-w-7xl mx-auto px-4 py-8">
        <div className="lg:grid lg:grid-cols-12 lg:gap-8">
          <nav className={`lg:col-span-3 ${mobileMenuOpen ? 'block' : 'hidden'} lg:block mb-8`}>
            <div className="bg-white rounded-lg shadow-sm p-4 space-y-2">
              {tabs.map((tab) => {
                const Icon = tab.icon;
                return (
                  <button key={tab.id} onClick={() => { setActiveTab(tab.id); setMobileMenuOpen(false); }} className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors ${activeTab === tab.id ? 'bg-indigo-600 text-white' : 'text-gray-700 hover:bg-gray-100'}`}>
                    <Icon className="w-5 h-5" />
                    <span className="font-medium">{tab.name}</span>
                  </button>
                );
              })}
            </div>
          </nav>

          <main className="lg:col-span-9">
            {activeTab === 'landing' && <LandingPage setActiveTab={setActiveTab} />}
            {activeTab === 'chat' && <MarkChatbot />}
            {activeTab === 'analyzer' && <CostAnalyzer />}
            {activeTab === 'aim' && <AIMComparison />}
            {activeTab === 'medicare' && <MedicareTransition />}
          </main>
        </div>
      </div>
    </div>
  );
};

const LandingPage = ({ setActiveTab }) => {
  return (
    <div className="space-y-12">
      {/* Hero Section */}
      <div className="bg-gradient-to-r from-blue-900 to-indigo-800 rounded-2xl shadow-xl p-8 md:p-12 text-white">
        <h1 className="text-4xl md:text-5xl font-bold mb-4">
          Optimize Your Municipality's <span className="text-yellow-400">Benefits Strategy</span>
        </h1>
        <p className="text-xl md:text-2xl mb-6 text-blue-100">
          Mark helps Indiana municipalities make data-driven decisions about employee benefits—from hire to retire.
        </p>
        <button 
          onClick={() => setActiveTab('aim')}
          className="bg-yellow-400 text-blue-900 px-8 py-4 rounded-lg font-bold text-lg hover:bg-yellow-300 transition-colors flex items-center space-x-2"
        >
          <span>Analyze Your Benefits</span>
          <ArrowRight className="w-5 h-5" />
        </button>
      </div>

      {/* The Opportunity */}
      <div className="bg-white rounded-xl shadow-sm p-8">
        <h2 className="text-3xl font-bold mb-6 text-gray-900">The Benefits Optimization Opportunity</h2>
        <div className="space-y-4 text-lg text-gray-700">
          <p>
            Municipal benefits programs haven't always kept pace with the changing insurance marketplace. Many municipalities stay with legacy providers simply because "that's how it's always been done."
          </p>
          <p className="font-semibold text-indigo-600">
            Based on market analysis, comparing your current costs to competitive alternatives can reveal significant savings opportunities—often 10-15% annually.
          </p>
          <div className="bg-blue-50 border-l-4 border-blue-500 p-6 my-6">
            <p className="font-bold text-blue-900 text-xl">
              For a 500-employee municipality, even a 12% cost reduction represents $500K+ in annual savings.
            </p>
          </div>
          <p>
            Mark provides the data and analysis tools you need to make informed decisions about your benefits strategy—whether that means optimizing your current plan or exploring alternatives.
          </p>
        </div>
      </div>

      {/* Real Data Example */}
      <div className="bg-indigo-50 rounded-xl border-2 border-indigo-200 p-8">
        <h3 className="text-2xl font-bold mb-4 text-indigo-900">Real Indiana Municipality Example</h3>
        <div className="grid md:grid-cols-2 gap-6">
          <div>
            <p className="text-sm text-gray-600 mb-2">Municipality Size</p>
            <p className="text-3xl font-bold text-gray-900">514 Employees</p>
          </div>
          <div>
            <p className="text-sm text-gray-600 mb-2">Potential Annual Savings</p>
            <p className="text-3xl font-bold text-green-600">$600K - $850K</p>
          </div>
        </div>
        <div className="mt-6 p-4 bg-white rounded-lg">
          <p className="text-gray-700">
            <strong>Current approach:</strong> Traditional group health coverage with full employer contribution for employee-only plans, family coverage with employee contribution.
          </p>
          <p className="text-gray-700 mt-2">
            <strong>Market comparison:</strong> Analyzing competitive options revealed potential savings of 12-15% while maintaining comparable coverage levels.
          </p>
          <p className="text-gray-700 mt-2 text-sm">
            <em>Results will vary by municipality size, demographics, and plan design. Mark provides customized analysis for your specific situation.</em>
          </p>
        </div>
      </div>

      {/* What Mark Does */}
      <div className="bg-white rounded-xl shadow-sm p-8">
        <h2 className="text-3xl font-bold mb-6 text-gray-900">What Mark Does</h2>
        <div className="grid md:grid-cols-3 gap-6">
          <div className="text-center p-6">
            <div className="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
              <Calculator className="w-8 h-8 text-blue-600" />
            </div>
            <h3 className="font-bold text-xl mb-2">Analyze Your Costs</h3>
            <p className="text-gray-600">Input your current AIM premiums and employee count. Mark calculates your total exposure.</p>
          </div>
          <div className="text-center p-6">
            <div className="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
              <TrendingUp className="w-8 h-8 text-green-600" />
            </div>
            <h3 className="font-bold text-xl mb-2">Compare to Market</h3>
            <p className="text-gray-600">See exactly how much you'd save with competitive market rates—based on real Indiana data.</p>
          </div>
          <div className="text-center p-6">
            <div className="bg-indigo-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
              <MessageSquare className="w-8 h-8 text-indigo-600" />
            </div>
            <h3 className="font-bold text-xl mb-2">Ask Mark Anything</h3>
            <p className="text-gray-600">Chat with Mark's AI assistant to learn about benefits, insurance strategies, and cost optimization.</p>
          </div>
        </div>
      </div>

      {/* CTA */}
      <div className="bg-gradient-to-r from-indigo-600 to-blue-600 rounded-2xl shadow-xl p-8 text-center text-white">
        <h2 className="text-3xl font-bold mb-4">Ready to Optimize Your Benefits?</h2>
        <p className="text-xl mb-6 text-blue-100">
          Get a comprehensive analysis of your current costs and explore opportunities for improvement.
        </p>
        <div className="flex flex-col sm:flex-row gap-4 justify-center">
          <button 
            onClick={() => setActiveTab('aim')}
            className="bg-white text-indigo-600 px-8 py-4 rounded-lg font-bold text-lg hover:bg-gray-100 transition-colors inline-flex items-center justify-center space-x-2"
          >
            <span>Compare Your Costs</span>
            <ArrowRight className="w-5 h-5" />
          </button>
          <button 
            onClick={() => setActiveTab('chat')}
            className="bg-yellow-400 text-blue-900 px-8 py-4 rounded-lg font-bold text-lg hover:bg-yellow-300 transition-colors inline-flex items-center justify-center space-x-2"
          >
            <MessageSquare className="w-5 h-5" />
            <span>Ask Mark</span>
          </button>
        </div>
      </div>
    </div>
  );
};

const MarkChatbot = () => {
  const [messages, setMessages] = useState([
    {
      role: 'assistant',
      content: "Hey there! I'm Mark, your benefits expert. I help Indiana municipalities understand insurance, optimize costs, and make smart benefits decisions from hire to retire. What would you like to know? (Try asking about market comparisons, Medicare transitions, HSAs, or any benefits topic!)"
    }
  ]);
  const [input, setInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const sendMessage = async () => {
    if (!input.trim() || isLoading) return;

    const userMessage = { role: 'user', content: input };
    setMessages(prev => [...prev, userMessage]);
    setInput('');
    setIsLoading(true);

    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 1000,
          system: `You are Mark, an enthusiastic and knowledgeable benefits consultant specializing in municipal employee benefits in Indiana. Your expertise includes:

- Benefits market analysis and cost comparison
- Medicare transitions and Medigap plan selection
- HSA strategies and contribution limits
- Benefits cost optimization for municipalities
- Indiana-specific insurance regulations and benchmarks
- Group health insurance plan design

Your personality:
- Friendly, approachable, and use casual language
- End responses with "Mark it, dude!" when giving strong recommendations
- Use real numbers and data when possible (e.g., "typical municipal health costs run $900-1,100/employee/month")
- Focus on practical, actionable advice
- Care deeply about helping municipalities save money while maintaining quality benefits
- Stay neutral when discussing specific providers - focus on helping municipalities make informed decisions

Keep responses concise but informative. If asked about specific calculations, encourage them to use the calculators in the app.`,
          messages: messages.concat(userMessage)
        })
      });

      const data = await response.json();
      
      if (!response.ok) {
        throw new Error(data.error || 'Failed to get response');
      }

      const assistantMessage = {
        role: 'assistant',
        content: data.content[0].text
      };

      setMessages(prev => [...prev, assistantMessage]);
    } catch (error) {
      console.error('Chat error:', error);
      setMessages(prev => [...prev, {
        role: 'assistant',
        content: "Oops! I'm having trouble connecting right now. Please try again in a moment."
      }]);
    } finally {
      setIsLoading(false);
    }
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  };

  const suggestedQuestions = [
    "How can we reduce our benefits costs?",
    "How does Medicare transition work?",
    "What's a good HSA contribution?",
    "What should I look for when comparing plans?"
  ];

  const askSuggested = (question) => {
    setInput(question);
  };

  return (
    <div className="space-y-4">
      <div className="bg-gradient-to-r from-blue-900 to-indigo-800 rounded-xl shadow-sm p-6 text-white">
        <div className="flex items-center space-x-3 mb-2">
          <MessageSquare className="w-8 h-8" />
          <h2 className="text-2xl font-bold">Ask Mark Anything</h2>
        </div>
        <p className="text-blue-100">Your AI benefits consultant, powered by real Indiana municipal data</p>
      </div>

      {messages.length === 1 && (
        <div className="bg-white rounded-lg shadow-sm p-6">
          <h3 className="font-semibold mb-3 text-gray-900">Popular Questions:</h3>
          <div className="grid md:grid-cols-2 gap-2">
            {suggestedQuestions.map((q, idx) => (
              <button
                key={idx}
                onClick={() => askSuggested(q)}
                className="text-left px-4 py-2 bg-blue-50 hover:bg-blue-100 rounded-lg text-sm text-blue-900 transition-colors"
              >
                {q}
              </button>
            ))}
          </div>
        </div>
      )}

      <div className="bg-white rounded-lg shadow-sm p-6">
        <div className="space-y-4 mb-4 max-h-[500px] overflow-y-auto">
          {messages.map((msg, idx) => (
            <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
              <div className={`max-w-[80%] rounded-lg p-4 ${
                msg.role === 'user' 
                  ? 'bg-indigo-600 text-white' 
                  : 'bg-gray-100 text-gray-900'
              }`}>
                {msg.role === 'assistant' && idx === 0 && (
                  <div className="flex items-center space-x-2 mb-2">
                    <div className="bg-blue-900 rounded px-2 py-1">
                      <span className="text-xs font-bold text-blue-400">MARK</span>
                    </div>
                  </div>
                )}
                <p className="whitespace-pre-wrap">{msg.content}</p>
              </div>
            </div>
          ))}
          {isLoading && (
            <div className="flex justify-start">
              <div className="bg-gray-100 rounded-lg p-4">
                <div className="flex space-x-2">
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }}></div>
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></div>
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }}></div>
                </div>
              </div>
            </div>
          )}
        </div>

        <div className="flex space-x-2">
          <input
            type="text"
            value={input}
            onChange={(e) => setInput(e.target.value)}
            onKeyPress={handleKeyPress}
            placeholder="Ask Mark about benefits, insurance, or cost savings..."
            className="flex-1 px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
            disabled={isLoading}
          />
          <button
            onClick={sendMessage}
            disabled={isLoading || !input.trim()}
            className="bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          >
            Send
          </button>
        </div>
      </div>
    </div>
  );
};

const CostAnalyzer = () => {
  const [data, setData] = useState({ employees: '', avgPremium: '' });
  const [results, setResults] = useState(null);

  const analyze = () => {
    const emp = parseInt(data.employees) || 45;
    const prem = parseInt(data.avgPremium) || 1200;
    setResults({
      totalAnnualCost: prem * emp * 12,
      perEmployeeCost: prem * 12,
      assessment: 'Based on Indiana benchmarks, your costs are approximately 8% above average.'
    });
  };

  return (
    <div className="space-y-6">
      <div className="bg-white rounded-lg shadow-sm p-6">
        <h2 className="text-2xl font-bold mb-4">Benefits Cost Analyzer</h2>
        <div className="grid md:grid-cols-2 gap-4 mb-6">
          <div>
            <label className="block text-sm font-medium mb-1">Number of Employees</label>
            <input type="number" value={data.employees} onChange={(e) => setData({...data, employees: e.target.value})} placeholder="45" className="w-full px-3 py-2 border rounded-md" />
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Avg Monthly Premium</label>
            <input type="number" value={data.avgPremium} onChange={(e) => setData({...data, avgPremium: e.target.value})} placeholder="1200" className="w-full px-3 py-2 border rounded-md" />
          </div>
        </div>
        <button onClick={analyze} className="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700">Analyze Costs</button>
      </div>
      {results && (
        <div className="bg-white rounded-lg shadow-sm p-6">
          <h3 className="text-lg font-semibold mb-3">Results</h3>
          <p className="text-3xl font-bold mb-2">${results.totalAnnualCost.toLocaleString()}</p>
          <p className="text-gray-600">{results.assessment}</p>
        </div>
      )}
    </div>
  );
};

const AIMComparison = () => {
  const [data, setData] = useState({ 
    municipality: '', 
    employees: '', 
    employeePremium: '',
    employerPremium: '',
    useTotal: true
  });
  const [results, setResults] = useState(null);

  const getEmployeeCount = () => parseInt(data.employees) || 500;
  
  const getSuggestedRange = () => {
    const emp = getEmployeeCount();
    if (emp < 100) return { low: 850, high: 1000 };
    if (emp < 300) return { low: 900, high: 1050 };
    return { low: 900, high: 1100 };
  };

  const compare = () => {
    const emp = getEmployeeCount();
    const employeePrem = parseFloat(data.employeePremium) || 0;
    const employerPrem = parseFloat(data.employerPremium) || 0;
    
    const totalPremium = employeePrem + employerPrem || 1000;
    const marketPrem = Math.round(totalPremium * 0.87); // 13% savings
    const savings = (totalPremium - marketPrem) * emp * 12;
    const monthlySavings = (totalPremium - marketPrem) * emp;

    setResults({
      municipality: data.municipality || 'Your Municipality',
      aimCost: totalPremium * emp * 12,
      marketCost: marketPrem * emp * 12,
      savings: savings,
      monthlySavings: monthlySavings,
      totalPremium: totalPremium,
      marketPremium: marketPrem,
      savingsPercent: Math.round(((totalPremium - marketPrem) / totalPremium) * 100),
      recommendation: `Based on actual Indiana market data, exploring competitive alternatives could save ${data.municipality || 'your municipality'} approximately $${savings.toLocaleString()} annually. That's $${monthlySavings.toLocaleString()} every month. Mark it, dude!`
    });
  };

  const range = getSuggestedRange();

  return (
    <div className="space-y-6">
      <div className="bg-white rounded-lg shadow-sm p-6">
        <h2 className="text-2xl font-bold mb-4">Benefits Market Comparison</h2>
        
        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
          <p className="text-sm text-blue-900">
            <strong>Typical municipal health benefits costs in Indiana:</strong> ${range.low}-${range.high}/employee/month
          </p>
        </div>

        <div className="grid md:grid-cols-2 gap-4 mb-6">
          <div>
            <label className="block text-sm font-medium mb-1">Municipality Name</label>
            <input 
              type="text" 
              value={data.municipality} 
              onChange={(e) => setData({...data, municipality: e.target.value})} 
              placeholder="City of Fishers" 
              className="w-full px-3 py-2 border rounded-md" 
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Number of Employees</label>
            <input 
              type="number" 
              value={data.employees} 
              onChange={(e) => setData({...data, employees: e.target.value})} 
              placeholder="500" 
              className="w-full px-3 py-2 border rounded-md" 
            />
          </div>
        </div>

        <div className="border-t pt-4 mb-4">
          <h3 className="font-semibold mb-3">Premium Breakdown (per employee/month)</h3>
          <div className="grid md:grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium mb-1">Employee Pays (Monthly)</label>
              <input 
                type="number" 
                value={data.employeePremium} 
                onChange={(e) => setData({...data, employeePremium: e.target.value})} 
                placeholder="85" 
                className="w-full px-3 py-2 border rounded-md" 
              />
              <p className="text-xs text-gray-500 mt-1">Average employee contribution</p>
            </div>
            <div>
              <label className="block text-sm font-medium mb-1">Employer Pays (Monthly)</label>
              <input 
                type="number" 
                value={data.employerPremium} 
                onChange={(e) => setData({...data, employerPremium: e.target.value})} 
                placeholder="915" 
                className="w-full px-3 py-2 border rounded-md" 
              />
              <p className="text-xs text-gray-500 mt-1">Your municipality's cost per employee</p>
            </div>
          </div>
          {(data.employeePremium || data.employerPremium) && (
            <div className="mt-3 p-3 bg-gray-50 rounded">
              <p className="text-sm font-medium">
                Total Premium: ${(parseFloat(data.employeePremium || 0) + parseFloat(data.employerPremium || 0)).toLocaleString()}/employee/month
              </p>
            </div>
          )}
        </div>

        <button onClick={compare} className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700">
          Compare to Market Rates
        </button>
      </div>

      {results && (
        <div className="space-y-4">
          <div className="grid md:grid-cols-3 gap-4">
            <div className="bg-white rounded-lg shadow-sm p-6">
              <p className="text-sm text-gray-500 mb-1">Current Annual Cost</p>
              <p className="text-2xl font-bold">${results.aimCost.toLocaleString()}</p>
              <p className="text-xs text-gray-500 mt-1">${results.totalPremium}/employee/month</p>
            </div>
            <div className="bg-white rounded-lg shadow-sm p-6">
              <p className="text-sm text-gray-500 mb-1">Est. Market Alternative</p>
              <p className="text-2xl font-bold text-blue-600">${results.marketCost.toLocaleString()}</p>
              <p className="text-xs text-gray-500 mt-1">${results.marketPremium}/employee/month</p>
            </div>
            <div className="bg-white rounded-lg shadow-sm p-6 border-2 border-green-500">
              <p className="text-sm text-gray-500 mb-1">Potential Savings</p>
              <p className="text-2xl font-bold text-green-600">${results.savings.toLocaleString()}</p>
              <p className="text-xs text-green-600 mt-1">${results.monthlySavings.toLocaleString()}/month ({results.savingsPercent}% reduction)</p>
            </div>
          </div>

          {/* Export Actions */}
          <div className="bg-white rounded-lg shadow-sm p-6">
            <h3 className="font-semibold mb-4">Share This Analysis</h3>
            <div className="grid md:grid-cols-3 gap-3">
              <button
                onClick={() => downloadPDF(results)}
                className="flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
              >
                <Download className="w-4 h-4" />
                <span>Download PDF</span>
              </button>
              <button
                onClick={() => emailReport(results)}
                className="flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
              >
                <Mail className="w-4 h-4" />
                <span>Email Report</span>
              </button>
              <button
                onClick={() => scheduleWebinarMeeting(results)}
                className="flex items-center justify-center space-x-2 px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
              >
                <Calendar className="w-4 h-4" />
                <span>Schedule Meeting</span>
              </button>
            </div>
          </div>

          <div className="bg-blue-50 border border-blue-200 rounded-lg p-6">
            <h3 className="font-semibold text-blue-900 mb-2">Mark's Analysis for {results.municipality}</h3>
            <p className="text-gray-800">{results.recommendation}</p>
          </div>

          <div className="bg-white rounded-lg shadow-sm p-6">
            <h3 className="font-semibold mb-3">What Could You Do With ${results.savings.toLocaleString()}?</h3>
            <ul className="space-y-2 text-gray-700">
              <li className="flex items-start">
                <CheckCircle className="w-5 h-5 text-green-500 mr-2 flex-shrink-0 mt-0.5" />
                <span>Hire {Math.floor(results.savings / 50000)} new full-time employees at $50K/year</span>
              </li>
              <li className="flex items-start">
                <CheckCircle className="w-5 h-5 text-green-500 mr-2 flex-shrink-0 mt-0.5" />
                <span>Fund infrastructure projects or equipment upgrades</span>
              </li>
              <li className="flex items-start">
                <CheckCircle className="w-5 h-5 text-green-500 mr-2 flex-shrink-0 mt-0.5" />
                <span>Reduce property tax burden on residents</span>
              </li>
              <li className="flex items-start">
                <CheckCircle className="w-5 h-5 text-green-500 mr-2 flex-shrink-0 mt-0.5" />
                <span>Build emergency fund reserves</span>
              </li>
            </ul>
          </div>
        </div>
      )}
    </div>
  );
};

const MedicareTransition = () => {
  const [data, setData] = useState({ currentPremium: '' });
  const [results, setResults] = useState(null);

  const calculate = () => {
    const prem = parseInt(data.currentPremium) || 800;
    const municipalityHRAContribution = 100;
    const typicalMedigapCost = 289;
    const employeeNetCost = municipalityHRAContribution + typicalMedigapCost;
    
    setResults({
      municipalitySavings: (prem - municipalityHRAContribution) * 12,
      employeeSavings: prem - employeeNetCost,
      municipalityMonthlyCost: municipalityHRAContribution,
      employeeMonthlyCost: employeeNetCost,
      recommendation: `I recommend Medicare + Medigap Plan G with a municipal HRA contribution of $${municipalityHRAContribution}/month. Employee pays ~$${employeeNetCost}/month total (vs $${prem} now), saving $${prem - employeeNetCost}/month. Municipality saves $${((prem - municipalityHRAContribution) * 12).toLocaleString()}/year per Medicare-eligible employee. Mark it, dude!`
    });
  };

  return (
    <div className="space-y-6">
      <div className="bg-white rounded-lg shadow-sm p-6">
        <h2 className="text-2xl font-bold mb-4">Medicare Transition Calculator</h2>
        <div className="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-6">
          <p className="text-sm text-indigo-900">
            <strong>Smart transition strategy:</strong> When employees hit 65, transitioning them to Medicare + Medigap saves both the municipality and the employee money.
          </p>
        </div>
        <div className="mb-6">
          <label className="block text-sm font-medium mb-1">Current Monthly Premium (Employer Cost)</label>
          <input 
            type="number" 
            value={data.currentPremium} 
            onChange={(e) => setData({...data, currentPremium: e.target.value})} 
            placeholder="800" 
            className="w-full px-3 py-2 border rounded-md" 
          />
          <p className="text-xs text-gray-500 mt-1">What the municipality currently pays per Medicare-eligible employee</p>
        </div>
        <button onClick={calculate} className="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700">
          Calculate Medicare Transition
        </button>
      </div>

      {results && (
        <div className="space-y-4">
          <div className="grid md:grid-cols-2 gap-4">
            <div className="bg-white rounded-lg shadow-sm p-6">
              <p className="text-sm text-gray-500 mb-1">Annual Municipality Savings (per employee)</p>
              <p className="text-2xl font-bold text-green-600">${results.municipalitySavings.toLocaleString()}</p>
              <p className="text-xs text-gray-500 mt-2">New cost: ${results.municipalityMonthlyCost}/month via HRA</p>
            </div>
            <div className="bg-white rounded-lg shadow-sm p-6">
              <p className="text-sm text-gray-500 mb-1">Employee Monthly Savings</p>
              <p className="text-2xl font-bold text-green-600">${results.employeeSavings}</p>
              <p className="text-xs text-gray-500 mt-2">New cost: ${results.employeeMonthlyCost}/month (Medicare + Medigap + Part D)</p>
            </div>
          </div>

          <div className="bg-indigo-50 border border-indigo-200 rounded-lg p-6">
            <h3 className="font-semibold text-indigo-900 mb-2">Mark's Recommendation</h3>
            <p className="text-gray-800">{results.recommendation}</p>
          </div>

          <div className="bg-white rounded-lg shadow-sm p-6">
            <h3 className="font-semibold mb-3">How It Works</h3>
            <div className="space-y-3 text-sm text-gray-700">
              <div className="flex items-start">
                <div className="bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mr-3">
                  <span className="text-blue-600 font-bold">1</span>
                </div>
                <p><strong>Employee enrolls in Medicare Parts A & B</strong> (Part B costs ~$174/month in 2024, deducted from Social Security)</p>
              </div>
              <div className="flex items-start">
                <div className="bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mr-3">
                  <span className="text-blue-600 font-bold">2</span>
                </div>
                <p><strong>Employee purchases Medigap Plan G</strong> (~$180/month) for comprehensive coverage</p>
              </div>
              <div className="flex items-start">
                <div className="bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mr-3">
                  <span className="text-blue-600 font-bold">3</span>
                </div>
                <p><strong>Employee adds Part D prescription coverage</strong> (~$35/month)</p>
              </div>
              <div className="flex items-start">
                <div className="bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mr-3">
                  <span className="text-blue-600 font-bold">4</span>
                </div>
                <p><strong>Municipality contributes to HRA</strong> (${results.municipalityMonthlyCost}/month) to help offset costs</p>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default MarkApp;
